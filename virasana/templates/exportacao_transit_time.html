<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Transit Time — Entradas no Recinto</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container-fluid py-2 px-2">
    <h1 class="mb-1">Entradas no Recinto 8931356 — {{ data_label }}</h1>

    {% set destino_label =
         ('8931356 - Santos Brasil' if destino == '8931356'
          else ('8931359 - BPT' if destino == '8931359' else destino)) %}
    <p class="text-muted">
      Janela: 00:00:00 a 23:59:59 · Direção: <strong>E</strong>
      · Saída anterior: <em>outro recinto</em>
      · Destino: <em>{{ destino_label }}</em>
    </p>
 

    <!-- Filtro por data (GET) -->
    <form class="row g-2 align-items-end mt-2 mb-4" method="get" action="">
      <div class="col-auto">
        <label for="data" class="form-label mb-0">Data</label>
        <input
          type="date"
          class="form-control"
          id="data"
          name="data"
          value="{{ data_iso }}"
          required
        />
      </div>

      <div class="col-auto">
        <label for="destino" class="form-label mb-0">Recinto de destino (E)</label>
        <select class="form-control" id="destino" name="destino">
          <option value="8931356" {{ 'selected' if destino == '8931356' else '' }}>8931356 - Santos Brasil</option>
          <option value="8931359" {{ 'selected' if destino == '8931359' else '' }}>8931359 - BPT</option>
        </select>
      </div>

      <div class="col-auto">
        <button type="submit" class="btn btn-primary">Aplicar</button>
      </div>
    </form>

    {% if resultados and resultados|length > 0 %}
	<div class="table-responsive shadow-sm rounded">
	  <table class="table table-sm align-middle mb-0 w-100">
          <thead class="table-secondary">
            <tr>
              <!-- ENTRADA -->
              <th scope="col">Número do Contêiner</th>
              <th scope="col">Data/Hora Ocorrência</th>
              <th scope="col">CNPJ Transportador</th>
              <th scope="col">Placa</th>
              <th scope="col">Motorista</th>
              <th scope="col">Vazio?</th>
              <!-- SAÍDA ANTERIOR -->
              <th scope="col">Recinto (origem)</th>
              <th scope="col">Data/Hora (saída)</th>
			  <th scope="col">Transit Time (h)</th>
            </tr> 
 </thead>
          <tbody class="bg-white">
            {% for r in resultados %}
            <tr>
              <!-- ENTRADA -->
              <td class="fw-semibold">{{ r.numeroConteiner }}</td>
              <td>{{ r.dataHoraOcorrencia.strftime("%d/%m/%Y %H:%M:%S") if r.dataHoraOcorrencia else '—' }}</td>
              <td>{{ r.cnpjTransportador or '—' }}</td>
              <td>{{ r.placa or '—' }}</td>
              <td>{{ r.nomeMotorista or '—' }} ({{ r.cpfMotorista or '—' }})</td>
              <td>{{ 'Sim' if r.vazioConteiner else 'Não' }}</td>
              <!-- SAÍDA ANTERIOR -->
              <td>{{ r.s_codigoRecinto or '—' }}</td>
              <td>{{ r.s_dataHoraOcorrencia.strftime("%d/%m/%Y %H:%M:%S") if r.s_dataHoraOcorrencia else '—' }}</td>
              <td>
                {% if r.transit_time_horas is not none %}
                  {{ "%.2f"|format(r.transit_time_horas) }}
                {% else %}
                  —
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-info">Nenhum registro de entrada encontrado para o período solicitado.</div>
    {% endif %}
  </div>
</body>
</html>
